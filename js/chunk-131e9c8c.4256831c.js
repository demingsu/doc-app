(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-131e9c8c"],{5918:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("layout",{attrs:{title:"管理采购单"},on:{addEvent:e.addEvent}},[a("ul",{staticClass:"common-content-container has-header",on:{scroll:e.scorllEvt}},[a("li",{staticClass:"header"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.projectName,expression:"projectName"}],attrs:{type:"text",placeholder:"输入项目名称进行查询"},domProps:{value:e.projectName},on:{input:function(t){t.target.composing||(e.projectName=t.target.value)}}}),a("van-dropdown-menu",[a("van-dropdown-item",{attrs:{options:e.stateOption},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}})],1),a("i",{on:{click:function(t){return e.btnEvt("query")}}})],1),e._l(e.list,(function(t){return a("li",{key:t.id,staticClass:"swipe-cell-item"},[a("van-swipe-cell",{scopedSlots:e._u([{key:"left",fn:function(){return[a("van-button",{attrs:{square:"",type:"primary",text:"详情"},on:{click:function(a){return e.$router.push({path:"/purchase/detail",query:{id:t.id}})}}})]},proxy:!0},{key:"right",fn:function(){return[a("van-button",{directives:[{name:"show",rawName:"v-show",value:"新建"===t.state,expression:"it.state === '新建'"}],attrs:{square:"",type:"danger",text:"删除"},on:{click:function(a){return e.btnEvt("delete",t)}}}),a("van-button",{directives:[{name:"show",rawName:"v-show",value:"新建"===t.state,expression:"it.state === '新建'"}],attrs:{square:"",type:"warning",text:"编辑"},on:{click:function(a){return e.btnEvt("edit",t)}}}),a("van-button",{directives:[{name:"show",rawName:"v-show",value:"新建"===t.state,expression:"it.state === '新建'"}],attrs:{square:"",type:"primary",text:"确认"},on:{click:function(a){return e.btnEvt("approve",t)}}}),a("van-button",{directives:[{name:"show",rawName:"v-show",value:"确认"===t.state,expression:"it.state === '确认'"}],attrs:{square:"",type:"primary",text:"在途"},on:{click:function(a){return e.btnEvt("approve",t)}}}),a("van-button",{directives:[{name:"show",rawName:"v-show",value:"在途"===t.state,expression:"it.state === '在途'"}],attrs:{square:"",type:"primary",text:"完成"},on:{click:function(a){return e.btnEvt("approve",t)}}}),a("van-button",{directives:[{name:"show",rawName:"v-show",value:"完成"===t.state,expression:"it.state === '完成'"}],attrs:{square:"",type:"primary",text:"收款",color:"#7232dd"},on:{click:function(a){return e.btnEvt("approve",t)}}})]},proxy:!0}],null,!0)},[a("van-cell",[a("div",[e._v(" "+e._s(t.projectName)+" "),"作废"!==t.state?a("em",{staticClass:"state-text"},[e._v(e._s(t.state))]):e._e()]),a("span",[e._v("创建人："+e._s(t.createName))]),a("span",[e._v("创建日期："+e._s(e._f("dateFormat")(t.createTime,"yyyy-MM-dd")))]),a("span",{staticClass:"t"},[e._v("材料："+e._s(t.materialName)+" -- "+e._s(t.materialWeight)+" "+e._s(t.materialUnit))]),"作废"===t.state?a("i",{staticClass:"cancel-icon"}):e._e()])],1)],1)})),e.loading?a("li",{staticClass:"more"},[a("van-loading",{attrs:{color:"#1989fa"}}),e._v(" 数据加载中... ")],1):a("li",{staticClass:"more"},[e._v(" "+e._s(e.hasMore?"上滑加载更多数据":"没有更多数据")+" ")])],2),a("van-popup",{style:{height:"286px"},attrs:{position:"bottom","close-on-click-overlay":!1},model:{value:e.payShow,callback:function(t){e.payShow=t},expression:"payShow"}},[a("div",{staticClass:"dialog-content"},[a("van-form",{ref:"payForm"},[a("van-field",{attrs:{name:"支付人",label:"支付人",readonly:""},model:{value:e.payObj.userName,callback:function(t){e.$set(e.payObj,"userName",t)},expression:"payObj.userName"}}),a("van-field",{attrs:{name:"支付金额",label:"支付金额",placeholder:"请输入支付金额",type:"number",rules:[{required:!0,message:"输入支付金额"}]},model:{value:e.payObj.amount,callback:function(t){e.$set(e.payObj,"amount",t)},expression:"payObj.amount"}}),a("van-field",{attrs:{name:"备注",label:"备注",type:"textarea",placeholder:"请输入备注",rules:[{required:!0,message:"输入支付备注"}]},model:{value:e.payObj.remark,callback:function(t){e.$set(e.payObj,"remark",t)},expression:"payObj.remark"}})],1),a("div",{staticClass:"btn"},[a("span",{on:{click:e.payEvent}},[e._v("支付")]),a("span",{staticClass:"c",on:{click:function(t){e.payShow=!1}}},[e._v("取消")])])],1)]),a("van-popup",{style:{height:"320px"},attrs:{position:"bottom","close-on-click-overlay":!1},model:{value:e.approveShow,callback:function(t){e.approveShow=t},expression:"approveShow"}},[a("div",{staticClass:"dialog-content"},[a("van-steps",{attrs:{active:e.approveStep,"active-icon":"success","active-color":"#fe5b02"}},[a("van-step",[e._v("新建")]),a("van-step",[e._v("确认")]),a("van-step",[e._v("在途")]),a("van-step",[e._v("完成")])],1),a("van-form",{ref:"approveForm"},[a("van-field",{attrs:{label:"新建"===e.state?"审批人":"确认"===e.state?"在途处理人":"完成处理人",readonly:""},model:{value:e.approveObj.userName,callback:function(t){e.$set(e.approveObj,"userName",t)},expression:"approveObj.userName"}}),a("van-field",{attrs:{label:"处理意见"},scopedSlots:e._u([{key:"input",fn:function(){return[a("van-radio-group",{attrs:{direction:"horizontal"},model:{value:e.approveObj.isReject,callback:function(t){e.$set(e.approveObj,"isReject",t)},expression:"approveObj.isReject"}},[a("van-radio",{attrs:{name:!1}},[e._v("通过")]),a("van-radio",{attrs:{name:!0}},[e._v("驳回")])],1)]},proxy:!0}])}),a("van-field",{attrs:{name:"备注",label:"备注",type:"textarea",placeholder:"请输入备注",rules:[{required:!0,message:"输入备注"}]},model:{value:e.approveObj.remark,callback:function(t){e.$set(e.approveObj,"remark",t)},expression:"approveObj.remark"}})],1),a("div",{staticClass:"btn"},[a("span",{on:{click:e.approveEvent}},[e._v(" "+e._s(["审批","在途","开始验收"][e.approveStep-1])+" ")]),a("span",{staticClass:"c",on:{click:function(t){e.approveShow=!1}}},[e._v("取消")])])],1)])],1)},n=[],s=a("46e5");function o(e){if(Array.isArray(e))return Object(s["a"])(e)}a("304d"),a("f257"),a("89a8"),a("2478"),a("b110"),a("fe35"),a("e766");function i(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var c=a("9135");a("8fec");function p(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e){return o(e)||i(e)||Object(c["a"])(e)||p()}var l=a("febe"),v=(a("e186"),a("10dd"),a("b3d9"),a("8ea3"),a("a6f5")),d=a("62aa"),m=a("e5f2"),h={mixins:[m["a"]],extends:v["a"],data:function(){return{projectName:"",state:"",stateOption:[{text:"全部",value:""},{text:"新建",value:"新建"},{text:"确认",value:"确认"},{text:"在途",value:"在途"},{text:"完成",value:"完成"},{text:"作废",value:"作废"}],payShow:!1,payObj:{id:"",amount:"",userId:"",userName:"",remark:""},approveShow:!1,approveStep:0,approveObj:{id:"",isReject:!1,userId:"",userName:"",remark:""}}},created:function(){this.payObj.userId=this.userInfo.id,this.payObj.userName=this.userInfo.name,this.approveObj.userId=this.userInfo.id,this.approveObj.userName=this.userInfo.name},methods:{getList:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,Object(d["e"])({page:e.paging.page,size:e.paging.size,projectName:e.projectName,state:e.state});case 3:return a=t.sent,200===a.code?(e.list=1===e.paging.page?a.data.rows:e.list.concat(a.data?a.data.rows:[]),e.hasMore=!!a.data&&a.data.total>e.paging.page*e.paging.size):e.paging.page-=1,t.next=7,e.$nextTick();case 7:e.loading=!1;case 8:case"end":return t.stop()}}),t)})))()},addEvent:function(){this.handleRole("PURCHASE-01-01","C")&&this.$router.push("/purchase/edit")},editEvt:function(e){this.handleRole("PURCHASE-01-01","U")&&this.$router.push({path:"/purchase/edit",query:{id:e.id}})},approveEvt:function(e){switch(e.state){case"完成":this.payObj.id=e.id,this.payObj.amount="",this.payObj.remark="",this.payShow=!0;break;default:this.approveStep=["新建","确认","在途","完成"].indexOf(e.state)+1,this.approveObj.id=e.id,this.approveObj.isReject=!1,this.approveObj.remark="",this.approveShow=!0;break}},deleteEvt:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.handleRole("PURCHASE-01-01","D")){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,Object(d["b"])(e.id);case 4:r=a.sent,200===r.code?(t.$toast.success("删除采购数据成功"),t.list=t.list.map((function(t){return t.id===e.id&&(t.state="作废"),t}))):t.$toast.fail("删除失败，请重试");case 6:case"end":return a.stop()}}),a)})))()},payEvent:function(){var e=this;this.handleRole("PURCHASE-01-01","A")&&this.$refs.payForm.validate().then(Object(l["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(d["f"])(e.payObj);case 2:a=t.sent,200===a.code?(e.$toast.success("采购付款成功"),e.payShow=!1):e.$toast.fail("采购付款失败，请重试");case 4:case"end":return t.stop()}}),t)})))).catch((function(){}))},approveEvent:function(){var e=this;this.handleRole("PURCHASE-01-01","A")&&this.$refs.approveForm.validate().then(Object(l["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(d["c"])(e.approveObj);case 2:if(a=t.sent,200!==a.code){t.next=12;break}return e.$toast.success("采购订单审批成功"),t.next=7,Object(d["d"])(e.approveObj.id);case 7:r=t.sent,200===r.code&&(e.list=u(e.list.map((function(t){return t.id===e.approveObj.id&&(t.state=r.data.state),t})))),e.approveShow=!1,t.next=13;break;case 12:e.$toast.fail("采购订单审批失败，请重试");case 13:case"end":return t.stop()}}),t)})))).catch((function(){}))}}},f=h,b=a("cba8"),y=Object(b["a"])(f,r,n,!1,null,null,null);t["default"]=y.exports},e5f2:function(e,t,a){"use strict";a("0560"),a("89a8"),a("2788"),a("aa08");var r={computed:{roles:function(){return this.$store.getters["common/getRoles"]}},methods:{handleRole:function(e,t){var a=this.roles.find((function(t){return t.id===e}));return!(!a||!a.role.includes(t))||(this.$toast.fail("你没有修改数据的权限"),!1)}}};t["a"]=r}}]);
//# sourceMappingURL=chunk-131e9c8c.4256831c.js.map